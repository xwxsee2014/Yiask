---
description: 从交互式或提供”的原则输入中创建或更新项目宪章，确保所有依赖模板保持同步
---

## 用户输入

```text
$ARGUMENTS
```

在继续之前，您**必须**考虑用户输入（如果不为空）。

## 大纲

您正在更新 `.specify/memory/constitution.md` 处的项目宪章。该文件是一个包含方括号中占位符标记的**模板**（例如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）。您的工作是(a) 收集/推导具体值，(b) 精确填充模板，以及(c) 将任何修订传播到依赖的工件中。

遵循以下执行流程：

1. 加载 `.specify/memory/constitution.md` 处的现有宪章模板。
   - 识别所有 `[ALL_CAPS_IDENTIFIER]` 形式的占位符标记。
   - **重要提示**：用户可能需要少于或多于模板中使用的原则。如果指定了数字，请尊重这一点 - 遵循通用模板。您将相应地更新文档。

2. 收集/推导占位符的值：
   - 如果用户输入（对话）提供了值，请使用它。
   - 否则从现有仓库上下文（README、文档、嵌入式的前期宪章版本）中推断。
   - 对于治理日期：`RATIFICATION_DATE` 是原始采用日期（如果未知，请询问或标记为 TODO），如果进行了更改，则 `LAST_AMENDED_DATE` 为今天，否则保持之前的值。
   - `CONSTITUTION_VERSION` 必须根据语义版本规则递增：
     - MAJOR：向后不兼容的治理/原则移除或重新定义。
     - MINOR：添加新原则/部分或实质性扩展指导。
     - PATCH：澄清、用词、拼写错误修复、非语义细化。
   - 如果版本升级类型不明确，请在最终确定前提出推理。

3. 起草更新后的宪章内容：
   - 将每个占位符替换为具体文本（不保留方括号标记，除了项目选择尚未定义的故意保留的模板槽位——明确证明任何保留的合理性）。
   - 保留标题层次结构，一旦替换即可删除注释，除非它们仍提供澄清指导。
   - 确保每个原则部分：简洁的名称行，捕获不可协商规则的段落（或项目列表），如果不明显则需要明确理由。
   - 确保治理部分列出修订程序、版本控制策略和合规审查期望。

4. 一致性传播检查清单（将先前的检查清单转换为活动验证）：
   - 读取 `.specify/templates/plan-template.md` 并确保任何"宪章检查"或规则与更新后的原则保持一致。
   - 读取 `.specify/templates/spec-template.md` 以保持范围/需求一致性——如果宪章添加/删除了强制部分或约束，请更新。
   - 读取 `.specify/templates/tasks-template.md` 并确保任务分类反映了新原则或已删除原则驱动的任务类型（例如，可观察性、版本控制、测试规范）。
   - 读取 `.specify/templates/commands/*.md` 中的每个命令文件（包括此文件）以验证没有过时的引用（特定代理名称如 CLAUDE）在需要通用指导时仍然存在。
   - 读取任何运行时指导文档（例如 `README.md`、`docs/quickstart.md` 或存在的代理特定指导文件）。更新对已更改原则的引用。

5. 生成同步影响报告（在更新后作为 HTML 注释预pend到宪章文件顶部）：
   - 版本更改：旧 → 新
   - 已修改原则列表（旧标题 → 新标题如果重命名）
   - 添加的部分
   - 移除的部分
   - 需要更新的模板（✅ 已更新 / ⚠ 待处理）及其文件路径
   - 任何故意延期的占位符的后续 TODOs。

6. 最终输出前的验证：
   - 没有剩余的未解释括号标记。
   - 版本行与报告匹配。
   - 日期格式为 ISO YYYY-MM-DD。
   - 原则是陈述性的、可测试的，没有模糊语言（"应该" → 在适当时用 MUST/SHOULD 理由替换）。

7. 将完成的宪章写回 `.specify/memory/constitution.md`（覆盖）。

8. 向用户输出最终摘要，包括：
   - 新版本和升级理由。
   - 任何标记为需要手动跟进的文件。
   - 建议的提交消息（例如 `docs: 修订宪章至 vX.Y.Z（原则添加 + 治理更新）`）。

格式和样式要求：

- 完全按照模板使用 Markdown 标题（不要降级/升级级别）。
- 包装长理由行以保持可读性（理想情况下 <100 个字符），但不要用生硬的断行强制执行。
- 部分之间保持一个空行。
- 避免尾随空格。

如果用户提供部分更新（例如，只修订一个原则），仍需执行验证和版本决策步骤。

如果缺少关键信息（例如，批准日期确实未知），插入 `TODO(<FIELD_NAME>): 解释` 并在同步影响报告的延期项目下包含。

不要创建新模板；始终操作现有的 `.specify/memory/constitution.md` 文件。

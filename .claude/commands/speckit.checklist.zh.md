---
description: 根据用户需求为当前功能生成自定义检查清单。
---

## 检查清单目的："需求的单元测试"

**核心概念**：检查清单是**需求编写的单元测试**——它们验证给定域中需求的质量、清晰度和完整性。

**不是用于验证/测试**：

- ❌ 不是"验证按钮点击是否正确"
- ❌ 不是"测试错误处理是否有效"
- ❌ 不是"确认 API 返回 200"
- ❌ 不是检查代码/实现是否与规范匹配

**用于需求质量验证**：

- ✅ "是否为所有卡片类型定义了视觉层次要求？"（完整性）
- ✅ "'突出显示'是否用具体尺寸/定位进行了量化？"（清晰度）
- ✅ "悬停状态要求在所有交互元素间是否一致？"（一致性）
- ✅ "是否定义了键盘导航的可访问性要求？"（覆盖率）
- ✅ "规范是否定义了徽标图像加载失败时发生什么？"（边界情况）

**类比**：如果你的规范是用英语编写的代码，那么检查清单就是它的单元测试套件。你在测试需求是否写得完整、清晰、明确且准备好实施——而不是测试实现是否有效。

## 用户输入

```text
$ARGUMENTS
```

在继续之前，你**必须**考虑用户输入（如果不为空）。

## 执行步骤

1. **设置**：从仓库根目录运行 `.specify/scripts/bash/check-prerequisites.sh --json` 并解析 JSON 以获取 FEATURE_DIR 和 AVAILABLE_DOCS 列表。
   - 所有文件路径必须是绝对路径。
   - 对于参数中的单引号，如 "I'm Groot"，使用转义语法：'I'\''m Groot'（如果可能，使用双引号："I'm Groot"）。

2. **澄清意图（动态）**：从用户措辞 + 从 spec/plan/tasks 中提取的信号中推导出最多三个初始上下文澄清问题（无预置目录）。它们必须：
   - 从用户措辞 + 从 spec/plan/tasks 中提取的信号生成
   - 只询问实质性改变检查清单内容的信息
   - 如果在 `$ARGUMENTS` 中已明确，则单独跳过
   - 优先精确而非广度

   生成算法：
   1. 提取信号：功能域关键字（如 auth、latency、UX、API）、风险指标（"critical"、"must"、"compliance"）、利益相关者提示（"QA"、"review"、"security team"）和明确交付物（"a11y"、"rollback"、"contracts"）。
   2. 将信号聚类为候选焦点领域（最多 4 个）并按相关性排序。
   3. 如果不明显，识别可能的受众和时机（作者、审阅者、QA、发布）。
   4. 检测缺失的维度：范围广度、深度/严格性、风险强调、排除边界、可衡量的验收标准。
   5. 从以下原型中选择制定问题：
      - 范围精化（例如，"这是否应包括与 X 和 Y 的集成接触点，或仅限于本地模块正确性？"）
      - 风险优先级（例如，"这些潜在风险区域中哪些应获得强制门控检查？"）
      - 深度校准（例如，"这是轻量级的预提交健全性列表还是正式发布门？"）
      - 受众框架（例如，"这将由作者使用还是在 PR 审阅期间由同行使用？"）
      - 边界排除（例如，"这轮是否应明确排除性能调优项目？"）
      - 场景类别差距（例如，"未检测到恢复流程——回滚/部分失败路径是否在范围内？"）

   问题格式化规则：
   - 如果呈现选项，生成包含以下列的紧凑表格：选项 | 候选 | 重要性
   - 限制最多 A–E 选项；如果自由格式答案更清楚，则省略表格
   - 永远不要让用户重复他们已经说过的话
   - 避免推测类别（不幻觉）。如果不确定，明确询问："确认 X 是否属于范围。"

   交互不可能时的默认值：
   - 深度：标准
   - 受众：如果与代码相关则为审阅者（PR）；否则为作者
   - 焦点：前 2 个相关性集群

   输出问题（标记为 Q1/Q2/Q3）。回答后：如果 ≥2 个场景类别（备用/异常/恢复/非功能域）仍不清楚，你可以提出最多两个更有针对性的后续问题（Q4/Q5），每个都有一行理由（例如，"未解决的恢复路径风险"）。不要超过五个问题。如果用户拒绝更多问题，则跳过升级。

3. **理解用户请求**：结合 `$ARGUMENTS` + 澄清答案：
   - 推导检查清单主题（例如，security、review、deploy、ux）
   - 合并用户明确提到的必须拥有项目
   - 将焦点选择映射到类别支架
   - 从 spec/plan/tasks 推断任何缺失的上下文（不要幻觉）

4. **加载功能上下文**：从 FEATURE_DIR 读取：
   - spec.md：功能需求和范围
   - plan.md（如果存在）：技术细节、依赖关系
   - tasks.md（如果存在）：实施任务

   **上下文加载策略**：
   - 仅加载与活动焦点领域相关的必要部分（避免完整文件转储）
   - 优先将长段总结为简洁的场景/需求要点
   - 使用渐进式披露：仅在检测到差距时才添加后续检索
   - 如果源文档很大，生成中间总结项目而不是嵌入原始文本

5. **生成检查清单** - 创建"需求的单元测试"：
   - 如果不存在，创建 `FEATURE_DIR/checklists/` 目录
   - 生成唯一的检查清单文件名：
     - 使用基于域的简短描述性名称（例如，`ux.md`、`api.md`、`security.md`）
     - 格式：`[domain].md`
     - 如果文件存在，追加到现有文件
   - 项目从 CHK001 开始顺序编号
   - 每次 `/speckit.checklist` 运行创建一个新文件（从不覆盖现有检查清单）

   **核心原则 - 测试需求，而非测试实现**：
   每个检查清单项目必须评估需求本身：
   - **完整性**：是否所有必要需求都存在？
   - **清晰度**：需求是否明确且具体？
   - **一致性**：需求是否相互对齐？
   - **可衡量性**：需求是否可以被客观验证？
   - **覆盖率**：是否所有场景/边界情况都已解决？

   **类别结构** - 按需求质量维度分组项目：
   - **需求完整性**（是否所有必要需求都已记录？）
   - **需求清晰度**（需求是否具体且明确？）
   - **需求一致性**（需求是否对齐且无冲突？）
   - **验收标准质量**（成功标准是否可衡量？）
   - **场景覆盖率**（是否所有流/案例都已解决？）
   - **边界情况覆盖率**（是否定义了边界条件？）
   - **非功能需求**（性能、安全、可访问性等——是否已指定？）
   - **依赖关系和假设**（是否已记录和验证？）
   - **歧义和冲突**（需要澄清什么？）

   **如何编写检查清单项目 - "英语的单元测试"**：

   ❌ **错误**（测试实现）：
   - "验证着陆页显示 3 个剧集卡片"
   - "测试悬停状态在桌面上工作"
   - "确认徽标点击导航到主页"

   ✅ **正确**（测试需求质量）：
   - "是否指定了精选剧集的确切数量和布局？" [完整性]
   - "'突出显示'是否用具体尺寸/定位进行了量化？" [清晰度]
   - "悬停状态要求在所有交互元素间是否一致？" [一致性]
   - "是否所有交互式 UI 都定义了键盘导航要求？" [覆盖率]
   - "是否指定了徽标图像加载失败时的回退行为？" [边界情况]
   - "是否定义了异步剧集数据的加载状态？" [完整性]
   - "规范是否定义了竞争 UI 元素的视觉层次？" [清晰度]

   **项目结构**：
   每个项目应遵循此模式：
   - 询问需求质量的问题格式
   - 关注规范/计划中写的内容（或未写的内容）
   - 在括号中包含质量维度 [完整性/清晰度/一致性/等]
   - 检查现有需求时引用规范章节 `[Spec §X.Y]`
   - 检查缺失需求时使用 `[Gap]` 标记

   **按质量维度的示例**：

   完整性：
   - "是否为所有 API 失败模式定义了错误处理要求？" [Gap]
   - "是否为所有交互元素指定了可访问性要求？" [完整性]
   - "是否为响应式布局定义了移动断点要求？" [Gap]

   清晰度：
   - "'快速加载'是否用具体时间阈值进行了量化？" [清晰度，Spec §NFR-2]
   - "'相关剧集'的选择标准是否明确定义？" [清晰度，Spec §FR-5]
   - "'突出'是否用可测量的视觉属性定义？" [歧义，Spec §FR-4]

   一致性：
   - "导航要求在所有页面间是否对齐？" [一致性，Spec §FR-10]
   - "着陆页和详情页间的卡片组件要求是否一致？" [一致性]

   覆盖率：
   - "是否为零状态场景（无剧集）定义了要求？" [覆盖率，边界情况]
   - "是否解决了并发用户交互场景？" [覆盖率，Gap]
   - "是否指定了部分数据加载失败的要求？" [覆盖率，异常流]

   可衡量性：
   - "视觉层次要求是否可测量/可测试？" [验收标准，Spec §FR-1]
   - "'平衡的视觉权重'能否客观验证？" [可衡量性，Spec §FR-2]

   **场景分类和覆盖率**（需求质量焦点）：
   - 检查是否存在以下要求：主要、备用、异常/错误、恢复、非功能场景
   - 对于每个场景类别，问："[场景类型]要求是否完整、清晰、一致？"
   - 如果场景类别缺失："[场景类型]要求是否故意排除或缺失？" [Gap]
   - 当状态变更时包括弹性/回滚："是否为迁移失败定义了回滚要求？" [Gap]

   **可追溯性要求**：
   - 最小值：≥80% 的项目必须包含至少一个可追溯性引用
   - 每个项目应引用：规范章节 `[Spec §X.Y]`，或使用标记：`[Gap]`、`[Ambiguity]`、`[Conflict]`、`[Assumption]`
   - 如果不存在 ID 系统："是否建立了需求和验收标准 ID 方案？" [可追溯性]

   **暴露和解决问题**（需求质量问题）：
   询问关于需求本身的问题：
   - 歧义："'快速'一词是否用具体指标量化？" [歧义，Spec §NFR-1]
   - 冲突："§FR-10 和 §FR-10a 之间的导航要求是否冲突？" [冲突]
   - 假设："'始终可用的播客 API'假设是否已验证？" [假设]
   - 依赖关系："是否记录了外部播客 API 要求？" [依赖，Gap]
   - 缺失定义："'视觉层次'是否用可测量标准定义？" [Gap]

   **内容整合**：
   - 软限制：如果原始候选项目 > 40，按风险/影响优先级排序
   - 合并检查相同需求方面的近重复项
   - 如果 > 5 个低影响边界情况，创建一个项目："边界情况 X、Y、Z 是否在需求中解决？" [覆盖率]

   **🚫 绝对禁止** - 这些使其成为实现测试，而不是需求测试：
   - ❌ 任何以"验证"、"测试"、"确认"、"检查" + 实现行为开头的项目
   - ❌ 引用代码执行、用户操作、系统行为
   - ❌ "显示正确"、"正常工作"、"按预期工作"
   - ❌ "点击"、"导航"、"渲染"、"加载"、"执行"
   - ❌ 测试用例、测试计划、QA 流程
   - ❌ 实现细节（框架、API、算法）

   **✅ 必需模式** - 这些测试需求质量：
   - ✅ "是否为 [场景] 定义/指定/记录了 [需求类型]？"
   - ✅ "[模糊术语] 是否用具体标准量化/澄清？"
   - ✅ "[章节 A] 和 [章节 B] 之间的要求是否一致？"
   - ✅ "[需求] 是否能客观测量/验证？"
   - ✅ "是否在需求中解决了 [边界情况/场景]？"
   - ✅ "规范是否定义了 [缺失方面]？"

6. **结构参考**：按照 `.specify/templates/checklist-template.md` 中的规范模板生成检查清单，用于标题、元部分、类别标题和 ID 格式化。如果模板不可用，使用：H1 标题、目的/创建元行、`##` 包含 `- [ ] CHK### <需求项目>` 行的类别部分，从 CHK001 开始的全局递增 ID。

7. **报告**：输出创建的检查清单的完整路径、项目计数，并提醒用户每次运行都会创建新文件。总结：
   - 选择的焦点领域
   - 深度级别
   - 执行者/时机
   - 合并的任何明确的用户指定必须拥有项目

**重要**：每次 `/speckit.checklist` 命令调用都会使用简短描述性名称创建检查清单文件，除非文件已存在。这允许：

- 多种不同类型的检查清单（例如，`ux.md`、`test.md`、`security.md`）
- 简单、可记忆的文件名，指示检查清单目的
- 在 `checklists/` 文件夹中轻松识别和导航

为避免混乱，使用描述性类型并在完成时清理过时的检查清单。

## 示例检查清单类型和项目

**UX 需求质量：** `ux.md`

示例项目（测试需求，而非实现）：

- "视觉层次要求是否用可测量标准定义？" [清晰度，Spec §FR-1]
- "UI 元素的数量和定位是否明确指定？" [完整性，Spec §FR-1]
- "交互状态要求（悬停、焦点、活动）是否一致定义？" [一致性]
- "是否为所有交互元素指定了可访问性要求？" [覆盖率，Gap]
- "图像加载失败时是否定义了回退行为？" [边界情况，Gap]
- "'突出显示'能否客观测量？" [可衡量性，Spec §FR-4]

**API 需求质量：** `api.md`

示例项目：

- "是否为所有失败场景指定了错误响应格式？" [完整性]
- "速率限制要求是否用具体阈值量化？" [清晰度]
- "身份验证要求在所有端点间是否一致？" [一致性]
- "是否定义了外部依赖的重试/超时要求？" [覆盖率，Gap]
- "版本控制策略是否在需求中记录？" [Gap]

**性能需求质量：** `performance.md`

示例项目：

- "性能要求是否用具体指标量化？" [清晰度]
- "是否为所有关键用户旅程定义性能目标？" [覆盖率]
- "不同负载条件下的性能要求是否指定？" [完整性]
- "性能要求能否客观测量？" [可衡量性]
- "高负载场景是否定义了降级要求？" [边界情况，Gap]

**安全需求质量：** `security.md`

示例项目：

- "是否为所有受保护资源指定了身份验证要求？" [覆盖率]
- "是否为敏感信息定义数据保护要求？" [完整性]
- "威胁模型是否已记录，要求是否与之对齐？" [可追溯性]
- "安全要求是否与合规义务一致？" [一致性]
- "是否定义了安全失败/泄露响应要求？" [Gap，异常流]

## 反例：不应该做什么

**❌ 错误 - 这些测试实现，而非需求：**

```markdown
- [ ] CHK001 - 验证着陆页显示 3 个剧集卡片 [Spec §FR-001]
- [ ] CHK002 - 测试悬停状态在桌面上正确工作 [Spec §FR-003]
- [ ] CHK003 - 确认徽标点击导航到主页 [Spec §FR-010]
- [ ] CHK004 - 检查相关剧集部分显示 3-5 个项目 [Spec §FR-005]
```

**✅ 正确 - 这些测试需求质量：**

```markdown
- [ ] CHK001 - 精选剧集的数量和布局是否明确指定？ [完整性，Spec §FR-001]
- [ ] CHK002 - 悬停状态要求是否在所有交互元素间一致定义？ [一致性，Spec §FR-003]
- [ ] CHK003 - 所有可点击品牌元素的导航要求是否清晰？ [清晰度，Spec §FR-010]
- [ ] CHK004 - 相关剧集的选择标准是否已记录？ [Gap，Spec §FR-005]
- [ ] CHK005 - 是否定义了异步剧集数据的加载状态要求？ [Gap]
- [ ] CHK006 - "视觉层次"要求能否客观测量？ [可衡量性，Spec §FR-001]
```

**关键差异**：

- 错误：测试系统是否正确工作
- 正确：测试需求是否正确编写
- 错误：行为验证
- 正确：需求质量验证
- 错误："它是否做 X？"
- 正确："X 是否明确指定？"

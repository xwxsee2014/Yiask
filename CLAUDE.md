# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is the **Specify Framework** - a Spec-Driven Development (SDD) framework that enables AI-guided feature development through structured workflows. It's a meta-framework that provides templates, scripts, and AI prompts for managing software development projects with a specification-first approach.

## Core Architecture

The framework implements a sequential workflow across 5 phases, with each phase building on the previous:

1. **Specify** (`/speckit.specify`) → Create feature specification from natural language
2. **Clarify** (`/speckit.clarify`) → Resolve ambiguities with targeted questions
3. **Plan** (`/speckit.plan`) → Generate technical implementation plan
4. **Tasks** (`/speckit.tasks`) → Break down into actionable, dependency-ordered tasks
5. **Implement** (`/speckit.implement`) → Execute task list with validation checkpoints

### Key Directory Structure

```
./
├── .specify/                  # Framework infrastructure
│   ├── scripts/bash/          # Core bash scripts
│   │   ├── common.sh          # Shared utilities and functions
│   │   ├── check-prerequisites.sh    # Validate workflow state
│   │   ├── create-new-feature.sh     # Initialize feature branch/directory
│   │   ├── setup-plan.sh            # Phase 1 setup script
│   │   └── update-agent-context.sh  # Sync AI agent context files
│   ├── templates/             # Document templates
│   │   ├── spec-template.md          # Feature specification template
│   │   ├── plan-template.md          # Implementation plan template
│   │   ├── tasks-template.md         # Task breakdown template
│   │   └── checklist-template.md     # Quality validation template
│   └── memory/
│       └── constitution.md           # Project governance principles
├── .github/prompts/           # AI agent prompt definitions for each workflow command
├── specs/[###-feature]/       # Per-feature documentation (auto-generated)
└── .claude/commands/          # Auto-generated AI command shortcuts
```

## Common Commands & Scripts

All scripts use **absolute paths** and support **JSON output** via `--json` flag for programmatic use.

### Essential Scripts

```bash
# Initialize new feature (creates branch + feature directory)
./.specify/scripts/bash/create-new-feature.sh "feature description"

# Check workflow prerequisites
./.specify/scripts/bash/check-prerequisites.sh --json

# Validate for implementation phase (requires tasks.md)
./.specify/scripts/bash/check-prerequisites.sh --json --require-tasks

# Update AI agent context files
./.specify/scripts/bash/update-agent-context.sh claude

# Get feature paths only (no validation)
./.specify/scripts/bash/check-prerequisites.sh --paths-only
```

### Available Commands (Slash Commands)

The framework supports these AI agent commands (accessed via `/` in Claude/Cursor):

- `/speckit.specify` - Create feature specification from natural language
- `/speckit.clarify` - Resolve ambiguities with targeted questions
- `/speckit.plan` - Generate technical implementation plan
- `/speckit.tasks` - Break down into actionable, dependency-ordered tasks
- `/speckit.implement` - Execute task list with validation
- `/speckit.checklist` - Generate quality validation checklist
- `/speckit.analyze` - Cross-artifact consistency analysis

Each command has its prompt defined in `.github/prompts/`.

## Feature Branch Workflow

**Branch naming convention**: `###-descriptive-name` (e.g., `001-user-auth`, `002-payment-processing`)

Features are zero-padded 3-digit prefixes (001, 002, 003...). The scripts auto-detect the next available number.

```bash
# Create new feature (auto-creates branch with proper naming)
./.specify/scripts/bash/create-new-feature.sh "Add user authentication system"

# For non-git repositories, set environment variable
export SPECIFY_FEATURE="001-user-authentication"
```

## Per-Feature Document Structure

When you run `/speckit.specify`, it creates:

```
specs/[###-feature-name]/
├── spec.md              # Business requirements & user stories (with P1/P2/P3 priorities)
├── plan.md              # Technical architecture & decisions
├── tasks.md             # Implementation task breakdown (generated by /speckit.tasks)
├── research.md          # Technical research & decisions
├── data-model.md        # Entity relationships & validation
├── quickstart.md        # Integration scenarios
├── contracts/           # API specifications (OpenAPI/GraphQL)
└── checklists/          # Quality validation checklists
```

## Constitution Principles

This framework is governed by the **Specify Constitution** (`.specify/memory/constitution.md`). Key principles:

1. **User Story Driven Development** - All features must have independently testable user stories with explicit P1/P2/P3 priorities
2. **Test-First (MANDATORY)** - TDD cycle required for all stories; Red-Green-Refactor strictly enforced
3. **Independent Testability** - Each story must be testable in isolation
4. **Phased Implementation** - Ordered phases: Setup → Foundational → User Stories → Polish
5. **Simplicity & Constitution Compliance** - Favor simplicity; all decisions validated against constitution

**Constitution Check** is a mandatory gate in `plan.md` - violations must be justified in writing.

## Development Guidelines

### Working with Specifications

- **User stories MUST have priorities** (P1, P2, P3) for independent delivery
- **Requirements MUST be testable** - avoid vague adjectives without metrics
- **Success criteria MUST be measurable** - quantify performance/UX targets
- **Each story should be independently implementable**

### Task Organization

- **Phase-based execution**: Setup → Foundation → User Stories → Polish
- **Parallel markers `[P]`** indicate tasks that can run simultaneously
- **Story mapping `[US1]`, `[US2]`** enables independent story delivery
- **Dependencies MUST be explicit** in task descriptions

### Script Integration Points

All bash scripts in `.specify/scripts/bash/` follow these patterns:
- Use **absolute paths** in all script calls
- Support **JSON output** via `--json` flag for programmatic use
- Include **error handling** with clear error codes and messages
- Provide **fallback support** for non-git repositories via `SPECIFY_FEATURE` env variable

## Multi-Agent Support

The framework maintains separate context files for different AI agents:
- **GitHub Copilot**: `.github/copilot-instructions.md`
- **Claude**: `CLAUDE.md` (this file)
- **Cursor**: `.cursor/rules/specify-rules.mdc`
- Others: See `update-agent-context.sh` for full list

Run `.specify/scripts/bash/update-agent-context.sh claude` after modifying constitution or templates to sync agent instructions.

## Error Handling & Recovery

### Common Issues

- **Branch not on feature format** → Feature branches must match `###-name` pattern
- **Missing prerequisites** → Run `check-prerequisites.sh` to validate workflow state
- **Constitution violations** → Address principle conflicts in plan.md before proceeding
- **Incomplete checklists** → Quality gates must pass before implementation

### Recovery Patterns

- **Restart from spec** - Re-run `/speckit.specify` to rebuild from requirements
- **Incremental fixes** - Use `/speckit.clarify` to resolve specification ambiguities
- **Task regeneration** - Re-run `/speckit.tasks` after plan changes

## Quality Gates & Review Process

Every implementation passes through:

1. **Constitution compliance check** - All plans validated against `.specify/memory/constitution.md`
2. **Coverage validation** - Every requirement must map to tasks
3. **Checklist validation** - Quality checklists must pass before implementation
4. **Traceability** - Requirements → Tasks → Implementation linkage

## Constitution-Driven Development

The `.specify/memory/constitution.md` file defines **non-negotiable project principles**. All planning phases validate against these principles with explicit compliance gates.

Constitution governance:
- **Supersedes all other practices**
- **Amendments require**: documentation of change + rationale + semantic version bump
- **MAJOR**: principle removal/redefinition
- **MINOR**: new principles
- **PATCH**: clarifications

## File Naming Conventions

- **Feature IDs**: Zero-padded 3-digit prefixes (001, 002, 003...)
- **Templates**: All in `.specify/templates/` with `-template.md` suffix
- **Scripts**: Bash scripts in `.specify/scripts/bash/` with `.sh` extension
- **Prompts**: AI commands in `.github/prompts/` with `.prompt.md` suffix

---

**Version**: 1.0.0 | **Framework**: Specify SDD | **Last Updated**: 2025-10-31
